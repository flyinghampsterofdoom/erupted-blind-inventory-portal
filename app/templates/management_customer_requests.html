{% extends 'base.html' %}
{% block content %}
<h1>Customer Requests</h1>

<form method="get" action="/management/customer-requests" style="display:flex; gap:10px; flex-wrap:wrap; align-items:end;">
  <div>
    <label>Location</label>
    <select name="store_id">
      <option value="">All</option>
      {% for store in stores %}
      <option value="{{ store.id }}" {% if selected_store_id == store.id %}selected{% endif %}>{{ store.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label>From</label>
    <input type="date" name="from" value="{{ from_date }}" />
  </div>
  <div>
    <label>To</label>
    <input type="date" name="to" value="{{ to_date }}" />
  </div>
  <button type="submit">Filter</button>
</form>

<h2>Submitted Requests</h2>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Store</th>
      <th>Requested Items</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    {% for row in submissions %}
    <tr>
      <td>{{ row.created_at }}</td>
      <td>{{ row.store_name }}</td>
      <td>{{ row.items_summary or '-' }}</td>
      <td>{{ row.notes or '-' }}</td>
    </tr>
    {% else %}
    <tr><td colspan="4">No customer requests found for current filters.</td></tr>
    {% endfor %}
  </tbody>
</table>

<h2>Item Counts</h2>
<table>
  <thead>
    <tr>
      <th>Item</th>
      <th>Count</th>
      <th>Update</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.name }}</td>
      <td>{{ item.request_count }}</td>
      <td>
        <form method="post" action="/management/customer-requests/items/{{ item.id }}/count" style="display:flex; gap:8px; align-items:center;">
          <input type="hidden" name="csrf_token" value="{{ csrf_token(request) }}" />
          <input type="number" min="0" step="1" name="request_count" value="{{ item.request_count }}" required />
          <button type="submit">Save</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="3">No request items yet.</td></tr>
    {% endfor %}
  </tbody>
</table>

<h2>Add Item</h2>
<form method="post" action="/management/customer-requests/items/create" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
  <input type="hidden" name="csrf_token" value="{{ csrf_token(request) }}" />
  <input type="text" name="name" placeholder="Item name" required />
  <button type="submit">Add Item</button>
</form>
{% endblock %}
